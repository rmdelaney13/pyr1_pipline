[DEFAULT]
# =========================
# ROOTS (edit per machine / per campaign)
# =========================

# Repo/pipeline root (makes paths relocatable)
PIPE_ROOT = /projects/ryde3462/software/pyr1_pipeline

# Where your campaign inputs/outputs live (scratch or project space)
CAMPAIGN_ROOT = /projects/ryde3462/sequence_docking_campaign

# High-IO / large outputs (always on scratch)
SCRATCH_ROOT = /scratch/alpine/ryde3462/sequence_docking_campaign

# Rosetta install (only needed if some scripts call it)
PathToRosetta = /projects/ryde3462/software/rosetta_bin_linux_2021.16.61629_bundle

# Recommended: run in a conda env that already has pyrosetta, and leave this blank.
# If you MUST use it, point to the *site-packages* that contains pyrosetta/.
PathToPyRosetta = /projects/ryde3462/software/PyRosetta4.Debug.python38.linux.release-375

# =========================
# TEMPLATE / TARGET DEFINITIONS (rarely change)
# =========================

# Pre/post PDB templates used for alignment & mutation
PrePDBFileName  = %(PIPE_ROOT)s/docking/ligand_alignment/files_for_PYR1_docking/3QN1_H2O.pdb
PostPDBFileName = %(PIPE_ROOT)s/docking/ligand_alignment/files_for_PYR1_docking/3QN1_nolig_H2O.pdb

# Alignment target residue in the PRE pose (chain+resid in the PDB file)
ResidueNumber = 1
ChainLetter = X

# If your protein has a ligand and requires .params files (space-separated)
ParamsList = %(PIPE_ROOT)s/docking/ligand_alignment/files_for_PYR1_docking/A8T.params

# If you have multiple residues in your ligand (rare)
LigandResidueNumber = 1

# Where create_table writes params/pdb conformer outputs
PathToConformers = %(CAMPAIGN_ROOT)s/conformers_deprot

# Shared table paths used by downstream grading scripts
CSVFileName = ligands.csv
PKLFileName = ligands.pkl

# Usually keep False; auto-alignment is slow and can be brittle
AutoGenerateAlignment = False


[SEQUENCE_DOCKING]
# =========================
# SEQUENCE THREADING (CSV-based)
# =========================

# Path to CSV with sequence signatures
# Format: name,signature
# Example:
#   seq1,QILMVAGDHVXXXXXX
#   seq2,AILVMQGDHVYYYYYY
SequenceCSV = %(CAMPAIGN_ROOT)s/sequences.csv

# Positions to thread signature onto (space-separated, must match signature length)
# For PYR1 pocket (16 positions):
ThreadingPositions = 59 79 81 90 92 106 108 115 118 120 139 157 158 161 162 165

# Keep intermediate outputs for inspection?
# If True, keeps rotated/ and pass_score_repacked_passN/ dirs in addition to clustered_final/
KeepIntermediateOutputs = True


[MULTIPLE_PASSES]
# =========================
# OUTPUT CONTROL (edit per campaign)
# =========================

# Number of independent sampling passes (often 1 if you use SLURM arrays)
NumPasses = 1

# Base directory for outputs (each sequence creates its own subdirs)
# Outputs will be organized as: %(SCRATCH_ROOT)s/pass_output/sequences/{seq_name}/clustered_final/
OutputDirBase = %(SCRATCH_ROOT)s/pass_output


[create_table]
# =========================
# LIGAND INPUTS (edit per campaign)
# =========================

# Input SDF(s): wildcard allowed
MoleculeSDFs = %(CAMPAIGN_ROOT)s/conformers_deprot/*.sdf

AcceptorMode=generic
DynamicAlignmentDebug = True

# Output table names (written in the working directory you run from)
CSVFileName = %(CAMPAIGN_ROOT)s/ligands.csv
PKLFileName = %(CAMPAIGN_ROOT)s/ligands.pkl

UseMoleculeID = False
NoName = True

# Dynamic atom-triplet generation from RDKit H-bond acceptors in input SDF
DynamicAcceptorAlignment = True
IncludeReverseNeighborOrder = False
MaxDynamicAlignments = 20

# Semicolon-separated target triplets on the template ligand residue
# Example shown for O2 with ring orientation flip
TargetAtomTriplets = O2-C11-C9; O2-C9-C11


[grade_conformers]
# =========================
# DOCKING / FILTER PARAMETERS
# =========================

# Logging / runtime diagnostics
DebugEveryN = 25
SlowMinimizationSeconds = 5.0

# Output location (NOTE: for sequence docking, outputs go to sequences/{seq_name}/ subdirs)
OutputDir = %(SCRATCH_ROOT)s/docked

# Collision grid
BinWidth = 1.0
VDW_Modifier = 0.70
IncludeSC = True

# Rigid-body perturbation
JumpNum = 2
Rotation = 25
Translation = 0.5
MaxPerturbTries = 30

# H-bond geometry filtering (CRITICAL for water-mediated binding)
EnableHBondGeometryFilter = True
UseClosestLigandAcceptor = True

# Loose capture window during sampling
HBondDistanceIdeal = 2.8
HBondDistanceIdealBuffer = 0.8
HBondDonorAngleMin = 120
HBondAcceptorAngleMin = 90
HBondQualityMin = 0.25

# Strong pull during minimization (guides ligand to water)
HBondConstraintWeight = 4.0
EnableDynamicWaterPullConstraint = True
HBondConstraintSD = 0.25
HBondConstraintCaptureMax = 8.0

# Strict final geometry enforcement
EnforceFinalIdealGeometry = True
HBondDonorAngleIdeal = 180
HBondDonorAngleBuffer = 40
HBondAcceptorAngleIdeal = 180
HBondAcceptorAngleBuffer = 30
RequireAcceptorIdealWindow = False

# Keep these sidechains when building backbone-only collision grid
# (typically conserved residues or those defining pocket shape)
BackboneClashKeepSidechains = 86 113 114

# Score cutoff for accepting docked poses
MaxScore = -300

# =========================
# CLUSTERING
# =========================

# Enable per-pass clustering (reduces redundant outputs)
EnablePoseClusteringInArrayTask = True
EnablePoseClustering = True

# RMSD cutoff (Angstroms) for ligand heavy-atom clustering
ClusterRMSDCutoff = 0.75

# Output directory for final clustered results
# For sequence docking, this becomes: {OutputDirBase}/sequences/{seq_name}/clustered_final/
ClusteredOutputDir =

# Name pattern for geometry summary CSV files
GeometryCSVName = hbond_geometry_summary.csv

# Prefix for output PDB files
OutputPrefix =

# Rename waters to TP3 format (for CHARMM compatibility)
RenameWaterToTP3 = True
